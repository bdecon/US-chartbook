% % % % % % % % % % % % % % 
%
%	U.S. Chartbook
%	Brian W. Dew (brianwdew@gmail.com)
%	Updated: December 15, 2019
%	GitHub repo contains to do list (issues)
%   https://github.com/bdecon/US-chartbook
%
% % % % % % % % % % % % % %
\PassOptionsToPackage{table}{xcolor}
\documentclass{report}

%
% % % % % % Packages % % % % % % % % % 
%
	
	\usepackage[letterpaper, margin=1.18in]{geometry}
	\usepackage{microtype}
	\usepackage[default]{lato}
	\usepackage{pgfplots, pgfplotstable}
	\usepackage{xcolor}
	\usepackage{array}
	\usepackage{fontawesome}
	\usepackage{fancyhdr}
	\usepackage[colorlinks, linkcolor=blue, filecolor=blue, 
		citecolor=blue, urlcolor=blue, linktoc=all, 
		pdfencoding=auto]{hyperref}
	\usetikzlibrary{pgfplots.dateplot}

%
% % % % % Document Settings % % % % % % % 
%

	% Paragraph spacing
		\setlength{\parskip}{8pt}
		\setlength{\parindent}{0pt}
		
%
% % % % % Graph Settings % % % % % % % 
%
	
	% Header and footer
	
	\pagestyle{fancy}
	\fancyhf{}
	\renewcommand{\headrulewidth}{0pt}
	\rfoot{\hyperlink{toc}{\faList}}
	\cfoot{\thepage}	
	
	
	% Color square
	\newcommand{\cbox}[1]{
		\begin{tikzpicture} \draw [#1, line width=6](0,0) -- (.2,0);  
		\end{tikzpicture}}
	\newcommand{\colorline}[2]{
		\begin{tikzpicture} \draw [#1, line width=1.8](0,0.2) -- +(0.6,0) node[right, black!80] {#2}; 
		\end{tikzpicture}}
		
	% Table link
	\newcommand{\tbllink}[1]{\href{https://raw.githubusercontent.com/bdecon/US-chartbook/master/chartbook/data/#1}{\faTable}}
	
	% Last two digits of year
	\makeatletter
	\newcommand*\short[1]{\expandafter\@gobbletwo\number\numexpr#1\relax}
	\makeatother	
	
	% Column width and alignment
	\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}	
	
	% Style for date plots
	\pgfplotsset{compat=newest, 
		scaled y ticks=false,
		axis line style={black!20}, 
		xtick style={black!20}, ytick style={draw=none},
		every tick label/.style={black!50, font=\scriptsize,
			/pgf/number format/assume math mode=true},
		width=13.0cm, height=4.8cm, 
		xticklabel style={align=left}, 
		yticklabel style={text width=0.85em, align=right},       
		axis x line*=bottom, x axis line style={black!50},
	    axis y line=left, y axis line style={opacity=0},
	    ymajorgrids, grid style={very thin, black!10},	        
	    every node near coord/.style={/pgf/number format/fixed,
	    	font=\scriptsize, style={black!70}},
	    legend style={legend columns=-1, draw=none, fill=none,
	    	/tikz/every even column/.append style={column sep=0.3cm}}}
	    	
	
	% stacked diverging bar
	\newcommand{\sbar}[4]{
		\addplot[ybar stacked, bar width=2.7pt, draw opacity=0, fill=#1] 
			table [x=#2, y=#3, col sep=comma]{#4};}
					
	% text node
	\newcommand{\stdnode}[3]{\node[below, align=left, shift=({#1,#2})]{#3};}	        
		        
	% Date (X) Axis Tick Marks, one tick per year, every even year labeled
	\newcommand{\dateaxisticks}{
		date coordinates in=x, axis line style={draw=none},
		xmax={2020-02-01},
		max space between ticks=40,	    
		xtick={{1990-01-01}, {1992-01-01}, {1994-01-01}, 
			{1996-01-01}, {1998-01-01}, {2000-01-01}, 
			{2002-01-01}, {2004-01-01}, {2006-01-01},
			{2008-01-01}, {2010-01-01}, {2012-01-01}, {2014-01-01},
		    {2016-01-01}, {2018-01-01}, {2020-01-01}},
		minor xtick={{1989-01-01}, {1991-01-01}, {1993-01-01},
			{1995-01-01}, {1997-01-01}, {1999-01-01}, 
			{2001-01-01}, {2003-01-01}, {2005-01-01}, {2007-01-01},
		    {2009-01-01}, {2011-01-01}, {2013-01-01}, {2015-01-01},
		    {2017-01-01}, {2019-01-01}},
		enlarge y limits={0.06}, enlarge x limits={0.01},
		}
		
	% Date (X) Axis Tick Marks, one tick per year, every even year labeled
	\newcommand{\shdateaxisticks}{
		date coordinates in=x, axis line style={draw=none},
		xmax={2021-02-01},
		max space between ticks=40,	    
		xtick={{1990-01-01}, {1995-01-01}, {2000-01-01}, 
			{2005-01-01}, {2010-01-01}, {2015-01-01}, {2020-01-01}},
		minor xtick={},
		enlarge y limits={0.06}, enlarge x limits={0.01},
		}
		
		
	% Date (X) Axis Tick Marks, one tick per year, every even year labeled
	\newcommand{\ltdateaxisticks}{
		date coordinates in=x, axis line style={draw=none},
		xmax={2020-07-01},
		max space between ticks=40,	    
		xtick={{2015-01-01}, {2016-01-01}, {2017-01-01}, {2018-01-01}, 
		    {2019-01-01}, {2020-01-01}},
		enlarge y limits={0.06}, enlarge x limits={0.01},
		}
		
		
	% Settings for y label text in horizontal bar charts
	\newcommand{\barylab}[2]{yticklabel style={text width=#1, align=right, 
		style={black!70}, text height=#2},}
	
	% Solid bars at significant  x or y values
	\newcommand{\bbar}[2]{extra #1 ticks = {{#2}}, extra #1 tick labels = ,
		extra #1 tick style = {grid=major, grid style={thick, black!25}},}
		
			% Solid bars at significant  x or y values
	\newcommand{\dbar}[2]{extra #1 ticks = {{#2}}, extra #1 tick labels = ,
		extra #1 tick style = {grid=major, grid style={dashed, thick, black!50}},}
		
	% Standard line
	\newcommand{\stdline}[4]{\addplot[very thick, no markers, color=#1] 
		table [x=#2, y=#3, col sep=comma] {#4};	}
		
	% Thin line
	\newcommand{\thinline}[4]{\addplot[no markers, color=#1] 
		table [x=#2, y=#3, col sep=comma] {#4};	}
		
	% Dashed line
	\newcommand{\dashline}[4]{\addplot[very thick, dashed, no markers, color=#1] 
		table [x=#2, y=#3, col sep=comma] {#4};	}
		
	% Thicker line
	\newcommand{\thickline}[4]{\addplot[ultra thick, no markers, color=#1] 
		table [x=#2, y=#3, col sep=comma] {#4};	}
		
	% Style for bar plots legend symbol		
		%\pgfplotsset{/pgfplots/area legend/.style={/pgfplots/legend image code/.code={
         %   \fill[##1] (0cm,-0.1cm) rectangle (0.6cm,0.1cm);}},}		
		
	% Additional bar plot settings
	\newcommand{\barplotnogrid}{xbar=0pt, axis line style={draw=none},
	    yticklabel style={align=left, anchor=east},
      		xmajorticks=false, ymajorgrids=false,   
	    ytick=data, tickwidth=0pt, reverse legend,
	    nodes near coords, nodes near coords align={horizontal},}  
		
	% Recession bars		
	\newcommand{\rbars}{
		\fill[color=black!10] (axis cs:{1990-07-01},\pgfkeysvalueof{/pgfplots/ymin}) rectangle 
			(axis cs:{1991-03-01}, \pgfkeysvalueof{/pgfplots/ymax});
		\fill[color=black!10] (axis cs:{2007-12-01},\pgfkeysvalueof{/pgfplots/ymin}) rectangle 
			(axis cs:{2009-07-01}, \pgfkeysvalueof{/pgfplots/ymax});
		\fill[color=black!10] (axis cs:{2001-03-01},\pgfkeysvalueof{/pgfplots/ymin}) rectangle 
			(axis cs:{2001-11-01}, \pgfkeysvalueof{/pgfplots/ymax});}
			
	\newcommand{\rebars}{
		\fill[color=black!10] (axis cs:{2007-12-01},\pgfkeysvalueof{/pgfplots/ymin}) rectangle 
			(axis cs:{2009-07-01}, \pgfkeysvalueof{/pgfplots/ymax});
		\fill[color=black!10] (axis cs:{2001-03-01},\pgfkeysvalueof{/pgfplots/ymin}) rectangle 
			(axis cs:{2001-11-01}, \pgfkeysvalueof{/pgfplots/ymax});}
	
	\newfontfamily\seriffont{SourceSerifPro}	
	
	\pgfplotstableread[header=true, col sep=semicolon]{data/quits_ind.csv}\quits
	
	
% % % % % % % %
%
%  Begin Document
%
% % % % % % % %		
\begin{document}



\noindent \normalsize \textbf{Quits Rate by Industry}\\
\footnotesize{\textit{voluntary separations as a share of }}\\
\footnotesize{\textit{total employment, selected industry }}\\
\footnotesize{\textit{groups, percent}}\\
\vspace{87mm}

\hspace{21mm} \begin{tikzpicture}[overlay]
	\begin{axis}[clip=false, stack negative=separate, ymajorgrids=false,
            yticklabels from table={\quits}{name},
			y axis line style={opacity=0},   
		    x axis line style={opacity=0}, 
			yticklabel style={black, font=\scriptsize, 
			align=left, anchor=east},  
			nodes near coords align={above},    
			nodes near coords style={/pgf/number format/.cd,fixed zerofill, 
				precision=1, assume math mode},  
            ytick=data, tickwidth=0pt, xmin=0,
            bar width=1.2ex, 
            extra x ticks={0}, extra x tick style={
                grid style={black}, xticklabel=\empty,},
            enlarge y limits={0.02}, enlarge x limits={0.02},
            legend cell align={left}, legend plot pos=right,
            width=6.6cm, height=11.0cm, legend style={legend columns=1, at={(1.01, 1.14)}},
            \barylab{2.4cm}{2.0ex}]
	\addplot[xbar stacked, bar shift=0pt, fill=black!3!white, draw=none] 
		table [y expr=-\coordindex, x index=1] {\quits};
	\addplot[xbar stacked, bar shift=0pt, fill=cyan!60!blue!30!white, draw=cyan!60!blue!30!white] 
		table [y expr=-\coordindex, x index=2] {\quits};	
	\addplot[xbar stacked, bar shift=0pt, fill=black!3!white, draw=none] 
		table [y expr=-\coordindex, x index=4] {\quits};	        
	\addplot[only marks, mark=diamond*, mark options={fill=blue!40!black, 
		draw=blue!40!black, scale=1.4}] 
		table [y expr=-\coordindex, x index=3] {\quits};
	\addplot [nodes near coords={\pgfmathprintnumber{\pgfkeysvalueof{/data point/x}}}, only marks, mark=none] table[y=y, x index=3] {\quits};
	\legend{, 2000-- range, ,\input{text/jolts_ltdate.txt}}
	\end{axis}
\end{tikzpicture}
\vspace{0.5mm}

\footnotesize{Source: Bureau of Labor Statistics} \hspace{25mm} \tbllink{quits_ind.csv}\\


\end{document}
